<!doctype html>
<html lang="en">
    <!--begin::Head-->
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>AdminLTE v4 | Dashboard</title>
        <!--begin::Primary Meta Tags-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="title" content="AdminLTE v4 | Dashboard" />
        <meta name="author" content="ColorlibHQ" />
        <meta
            name="description"
            content="AdminLTE is a Free Bootstrap 5 Admin Dashboard, 30 example pages using Vanilla JS."
            />
        <meta
            name="keywords"
            content="bootstrap 5, bootstrap, bootstrap 5 admin dashboard, bootstrap 5 dashboard, bootstrap 5 charts, bootstrap 5 calendar, bootstrap 5 datepicker, bootstrap 5 tables, bootstrap 5 datatable, vanilla js datatable, colorlibhq, colorlibhq dashboard, colorlibhq admin dashboard"
            />
        <!--end::Primary Meta Tags-->
        <!--begin::Fonts-->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css"
            integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q="
            crossorigin="anonymous"
            />
        <!--end::Fonts-->
        <!--begin::Third Party Plugin(OverlayScrollbars)-->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/styles/overlayscrollbars.min.css"
            integrity="sha256-tZHrRjVqNSRyWg2wbppGnT833E/Ys0DHWGwT04GiqQg="
            crossorigin="anonymous"
            />
        <!--end::Third Party Plugin(OverlayScrollbars)-->
        <!--begin::Third Party Plugin(Bootstrap Icons)-->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
            integrity="sha256-9kPW/n5nn53j4WMRYAxe9c1rCY96Oogo/MKSVdKzPmI="
            crossorigin="anonymous"
            />
        <!--end::Third Party Plugin(Bootstrap Icons)-->
        <!--begin::Required Plugin(AdminLTE)-->
        <link rel="stylesheet" href="../../dist/css/adminlte.css" />
        <!--end::Required Plugin(AdminLTE)-->
        <!-- apexcharts -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/apexcharts@3.37.1/dist/apexcharts.css"
            integrity="sha256-4MX+61mt9NVvvuPjUWdUdyfZfxSB1/Rf9WtqRHgG5S0="
            crossorigin="anonymous"
            />
        <!-- jsvectormap -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/jsvectormap@1.5.3/dist/css/jsvectormap.min.css"
            integrity="sha256-+uGLJmmTKOqBr+2E6KDYs/NRsHxSkONXFHUL0fy2O/4="
            crossorigin="anonymous"
            />
        <!-- SDK de Google Identity Services -->
        <script src="https://accounts.google.com/gsi/client" async defer></script>
        <!-- Reemplaza el CDN de CryptoJS por tu archivo local -->
        <script src="../../CryptoJS v3.1.2/rollups/sha1.js" type="text/javascript"></script>
        
    </head>
    <!--end::Head-->
    <!--begin::Body-->
    <body class="layout-fixed sidebar-expand-lg bg-body-tertiary">
        <!--begin::App Wrapper-->
        <div class="app-wrapper">
            <!--begin::Header-->
            <nav class="app-header navbar navbar-expand bg-body">
                <!--begin::Container-->
                <div class="container-fluid">
                    <!--begin::Start Navbar Links-->
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" data-lte-toggle="sidebar" href="#" role="button">
                                <i class="bi bi-list"></i>
                            </a>
                        </li>
                    </ul>
                    <!--end::Start Navbar Links-->
                    <!--begin::End Navbar Links-->
                    <ul class="navbar-nav ms-auto">
                       <!--begin::Fullscreen Toggle-->
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-lte-toggle="fullscreen">
                                <i data-lte-icon="maximize" class="bi bi-arrows-fullscreen"></i>
                                <i data-lte-icon="minimize" class="bi bi-fullscreen-exit" style="display: none"></i>
                            </a>
                        </li>
                        <!--end::Fullscreen Toggle-->
                        <!--begin::User Menu Dropdown-->
                        <li class="nav-item dropdown user-menu">
                            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                                <img
                                    src="../../dist/assets/img/user2-160x160.jpg"
                                    class="user-image rounded-circle shadow"
                                    alt="User Image"
                                    />
                                <span class="d-none d-md-inline">Alexander Pierce</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-lg dropdown-menu-end">
                                <!--begin::User Image-->
                                <li class="user-header text-bg-primary">
                                    <img
                                        src="../../dist/assets/img/user2-160x160.jpg"
                                        class="rounded-circle shadow"
                                        alt="User Image"
                                        />
                                    <p>
                                        Alexander Pierce - Web Developer
                                        <small>Member since Nov. 2023</small>
                                    </p>
                                </li>
                                <!--end::User Image-->
                                <!--begin::Menu Body-->
                                <li class="user-body">
                                    <!--begin::Row-->
                                    <div class="row">
                                        <div class="col-4 text-center"><a href="#">Followers</a></div>
                                        <div class="col-4 text-center"><a href="#">Sales</a></div>
                                        <div class="col-4 text-center"><a href="#">Friends</a></div>
                                    </div>
                                    <!--end::Row-->
                                </li>
                                <!--end::Menu Body-->
                                <!--begin::Menu Footer-->
                                <li class="user-footer">
                                    <a href="#" class="btn btn-default btn-flat">Profile</a>
                                    <!-- Botón de cambio de contraseña (solo para usuarios tradicionales) -->
                                    <button id="btn-cambiar-pass" class="btn btn-default btn-flat" data-bs-toggle="modal" data-bs-target="#cambiarPassModal">
                                        Cambiar contraseña
                                    </button>
                                    <a href="#" class="btn btn-default btn-flat float-end">Sign out</a>
                                </li>
                                <!--end::Menu Footer-->
                            </ul>
                        </li>
                        <!--end::User Menu Dropdown-->
                    </ul>
                    <!--end::End Navbar Links-->
                </div>
                <!--end::Container-->
            </nav>
            <!--end::Header-->
            <!--begin::Sidebar-->
            <aside class="app-sidebar bg-body-secondary shadow" data-bs-theme="dark">
                <!--begin::Sidebar Brand-->
                <div class="sidebar-brand">
                    <!--begin::Brand Link-->
                    <a href="./index.html" class="brand-link">
                        <!--begin::Brand Image-->
                        <img
                            src="../../dist/assets/img/AdminLTELogo.png"
                            alt="AdminLTE Logo"
                            class="brand-image opacity-75 shadow"
                            />
                        <!--end::Brand Image-->
                        <!--begin::Brand Text-->
                        <span class="brand-text fw-light">AdminLTE 4</span>
                        <!--end::Brand Text-->
                    </a>
                    <!--end::Brand Link-->
                </div>
                <!--end::Sidebar Brand-->
                <!--begin::Sidebar Wrapper-->
                <div class="sidebar-wrapper">
                    <nav class="mt-2">
                        <!--begin::Sidebar Menu-->
                        <ul
                            class="nav sidebar-menu flex-column"
                            data-lte-toggle="treeview"
                            role="menu"
                            data-accordion="false"
                            >
                            <li class="nav-item menu-open">
                                <a href="#" class="nav-link active">
                                    <i class="nav-icon bi bi-speedometer"></i>
                                    <p>
                                        Dashboard
                                        <i class="nav-arrow bi bi-chevron-right"></i>
                                    </p>
                                </a>
                                <ul class="nav nav-treeview">
                                    <li class="nav-item">
                                        <a href="./index.html" class="nav-link active">
                                            <i class="nav-icon bi bi-circle"></i>
                                            <p>Dashboard v1</p>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                           
                        </ul>
                        <!--end::Sidebar Menu-->
                    </nav>
                </div>
                <!--end::Sidebar Wrapper-->
            </aside>
            <!--end::Sidebar-->
            <!--begin::App Main-->
            <main class="app-main">
                <div class="container mt-4">
                    <div class="card">
                        <div class="card-header bg-dark text-white">
                            <h5>Lista de Productos</h5>
                        </div>
                        <div class="card-header bg-secondary text-white">
                            <button id="nuevoProductoBtn" class="btn btn-primary">
                                <i class="bi bi-plus-circle"></i> Nuevo Producto
                            </button>
                        </div>
                        <div class="card-body">
                            <table id="productosTable" class="table table-bordered table-striped">
                                <thead class="table-dark">
                                    <tr>
                                        <th>CODIGO</th>
                                        <th>NOMBRE</th>
                                        <th>DESCRIPCION</th>
                                        <th>PRECIO</th>
                                        <th>STOCK</th>
                                        <th>FECHA</th>
                                        <th>ACCIONES</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Datos cargados via AJAX -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!--end::App Content-->
            </main>
            <!--end::App Main-->
            <!--begin::Footer-->
            <footer class="app-footer">
                <!--begin::To the end-->
                <div class="float-end d-none d-sm-inline">Anything you want</div>
                <!--end::To the end-->
                <!--begin::Copyright-->
                <strong>
                    Copyright &copy; 2014-2024&nbsp;
                    <a href="https://adminlte.io" class="text-decoration-none">AdminLTE.io</a>.
                </strong>
                All rights reserved.
                <!--end::Copyright-->
            </footer>
            <!--end::Footer-->
        </div>
        <!--end::App Wrapper-->
        <!--begin::Script-->
        <!--begin::Third Party Plugin(OverlayScrollbars)-->
        <script
            src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/browser/overlayscrollbars.browser.es6.min.js"
            integrity="sha256-dghWARbRe2eLlIJ56wNB+b760ywulqK3DzZYEpsg2fQ="
            crossorigin="anonymous"
        ></script>
        <!--end::Third Party Plugin(OverlayScrollbars)--><!--begin::Required Plugin(popperjs for Bootstrap 5)-->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>
        <!--end::Required Plugin(popperjs for Bootstrap 5)--><!--begin::Required Plugin(Bootstrap 5)-->
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
            integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
            crossorigin="anonymous"
        ></script>
        <!--end::Required Plugin(Bootstrap 5)--><!--begin::Required Plugin(AdminLTE)-->
        <script src="../../dist/js/adminlte.js"></script>
        <!--end::Required Plugin(AdminLTE)--><!--begin::OverlayScrollbars Configure-->
        <script>
            const SELECTOR_SIDEBAR_WRAPPER = '.sidebar-wrapper';
            const Default = {
                scrollbarTheme: 'os-theme-light',
                scrollbarAutoHide: 'leave',
                scrollbarClickScroll: true,
            };
            document.addEventListener('DOMContentLoaded', function () {
                const sidebarWrapper = document.querySelector(SELECTOR_SIDEBAR_WRAPPER);
                if (sidebarWrapper && typeof OverlayScrollbarsGlobal?.OverlayScrollbars !== 'undefined') {
                    OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
                        scrollbars: {
                            theme: Default.scrollbarTheme,
                            autoHide: Default.scrollbarAutoHide,
                            clickScroll: Default.scrollbarClickScroll,
                        },
                    });
                }
            });
        </script>
        <!--end::OverlayScrollbars Configure-->
        <!-- OPTIONAL SCRIPTS -->
        <!-- sortablejs -->
        <script
            src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"
            integrity="sha256-ipiJrswvAR4VAx/th+6zWsdeYmVae0iJuiR+6OqHJHQ="
            crossorigin="anonymous"
        ></script>
        <!-- sortablejs -->
        <script>
            const connectedSortables = document.querySelectorAll('.connectedSortable');
            connectedSortables.forEach((connectedSortable) => {
                let sortable = new Sortable(connectedSortable, {
                    group: 'shared',
                    handle: '.card-header',
                });
            });

            const cardHeaders = document.querySelectorAll('.connectedSortable .card-header');
            cardHeaders.forEach((cardHeader) => {
                cardHeader.style.cursor = 'move';
            });
        </script>
        <!-- apexcharts -->
        <script
            src="https://cdn.jsdelivr.net/npm/apexcharts@3.37.1/dist/apexcharts.min.js"
            integrity="sha256-+vh8GkaU7C9/wbSLIcwq82tQ2wTf44aOHA8HlBMwRI8="
            crossorigin="anonymous"
        ></script>
        <!-- ChartJS -->
        <script>
            // NOTICE!! DO NOT USE ANY OF THIS JAVASCRIPT
            // IT'S ALL JUST JUNK FOR DEMO
            // ++++++++++++++++++++++++++++++++++++++++++

            const sales_chart_options = {
                series: [
                    {
                        name: 'Digital Goods',
                        data: [28, 48, 40, 19, 86, 27, 90],
                    },
                    {
                        name: 'Electronics',
                        data: [65, 59, 80, 81, 56, 55, 40],
                    },
                ],
                chart: {
                    height: 300,
                    type: 'area',
                    toolbar: {
                        show: false,
                    },
                },
                legend: {
                    show: false,
                },
                colors: ['#0d6efd', '#20c997'],
                dataLabels: {
                    enabled: false,
                },
                stroke: {
                    curve: 'smooth',
                },
                xaxis: {
                    type: 'datetime',
                    categories: [
                        '2023-01-01',
                        '2023-02-01',
                        '2023-03-01',
                        '2023-04-01',
                        '2023-05-01',
                        '2023-06-01',
                        '2023-07-01',
                    ],
                },
                tooltip: {
                    x: {
                        format: 'MMMM yyyy',
                    },
                },
            };

            const sales_chart = new ApexCharts(
                    document.querySelector('#revenue-chart'),
                    sales_chart_options,
                    );
            sales_chart.render();
        </script>
        <!-- jsvectormap -->
        <script
            src="https://cdn.jsdelivr.net/npm/jsvectormap@1.5.3/dist/js/jsvectormap.min.js"
            integrity="sha256-/t1nN2956BT869E6H4V1dnt0X5pAQHPytli+1nTZm2Y="
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/jsvectormap@1.5.3/dist/maps/world.js"
            integrity="sha256-XPpPaZlU8S/HWf7FZLAncLg2SAkP8ScUTII89x9D3lY="
            crossorigin="anonymous"
        ></script>
        <!-- jsvectormap -->
        <script>
            const visitorsData = {
                US: 398, // USA
                SA: 400, // Saudi Arabia
                CA: 1000, // Canada
                DE: 500, // Germany
                FR: 760, // France
                CN: 300, // China
                AU: 700, // Australia
                BR: 600, // Brazil
                IN: 800, // India
                GB: 320, // Great Britain
                RU: 3000, // Russia
            };

            // World map by jsVectorMap
            const map = new jsVectorMap({
                selector: '#world-map',
                map: 'world',
            });

            // Sparkline charts
            const option_sparkline1 = {
                series: [
                    {
                        data: [1000, 1200, 920, 927, 931, 1027, 819, 930, 1021],
                    },
                ],
                chart: {
                    type: 'area',
                    height: 50,
                    sparkline: {
                        enabled: true,
                    },
                },
                stroke: {
                    curve: 'straight',
                },
                fill: {
                    opacity: 0.3,
                },
                yaxis: {
                    min: 0,
                },
                colors: ['#DCE6EC'],
            };

            const sparkline1 = new ApexCharts(document.querySelector('#sparkline-1'), option_sparkline1);
            sparkline1.render();

            const option_sparkline2 = {
                series: [
                    {
                        data: [515, 519, 520, 522, 652, 810, 370, 627, 319, 630, 921],
                    },
                ],
                chart: {
                    type: 'area',
                    height: 50,
                    sparkline: {
                        enabled: true,
                    },
                },
                stroke: {
                    curve: 'straight',
                },
                fill: {
                    opacity: 0.3,
                },
                yaxis: {
                    min: 0,
                },
                colors: ['#DCE6EC'],
            };

            const sparkline2 = new ApexCharts(document.querySelector('#sparkline-2'), option_sparkline2);
            sparkline2.render();

            const option_sparkline3 = {
                series: [
                    {
                        data: [15, 19, 20, 22, 33, 27, 31, 27, 19, 30, 21],
                    },
                ],
                chart: {
                    type: 'area',
                    height: 50,
                    sparkline: {
                        enabled: true,
                    },
                },
                stroke: {
                    curve: 'straight',
                },
                fill: {
                    opacity: 0.3,
                },
                yaxis: {
                    min: 0,
                },
                colors: ['#DCE6EC'],
            };

            const sparkline3 = new ApexCharts(document.querySelector('#sparkline-3'), option_sparkline3);
            sparkline3.render();
        </script>
        <!--end::Script-->
        <!-- ... otros scripts existentes ... -->

        <!-- jQuery (necesario para DataTables) - Asegúrate que solo se cargue una vez -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <!-- DataTables CSS y JS -->
        <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
        <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>

        <!-- Toastr para notificaciones (opcional) -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

        <!-- Tu script de DataTables personalizado -->
        <script>
            $(document).ready(function () {
                // Configuración de DataTables
                var table = $('#productosTable').DataTable({
                    ajax: {
                        url: '/ExamenMod2CriptoJara/productosservlet?action=list',
                        type: 'GET',
                        dataSrc: '',
                        error: function (xhr, error, thrown) {
                            console.error('Error en DataTables:', xhr.responseText);
                            toastr.error('Error al cargar datos: ' + xhr.status);
                        }
                    },
                    columns: [
                        {data: 'codiProd', title: 'CÓDIGO'},
                        {data: 'nombProd', title: 'NOMBRE'},
                        {data: 'descProd', title: 'DESCRIPCIÓN'},
                        {
                            data: 'precProd',
                            title: 'PRECIO',
                            render: function (data) {
                                return '$' + parseFloat(data).toFixed(2);
                            }
                        },
                        {data: 'stockProd', title: 'STOCK'},
                        {
                            data: 'fechProd',
                            title: 'FECHA',
                            render: function (data, type, row) {
                                if (type === 'display' || type === 'filter') {
                                    return data ? new Date(data).toLocaleString() : '';
                                }
                                return data;
                            }
                        },
                        {
                            data: null,
                            title: 'ACCIONES',
                            render: function (data, type, row) {
                                return `
                        <button class="btn btn-sm btn-warning edit-btn" data-id="${row.codiProd}">
                            <i class="bi bi-pencil"></i> Editar
                        </button>
                        <button class="btn btn-sm btn-danger delete-btn" data-id="${row.codiProd}">
                            <i class="bi bi-trash"></i> Eliminar
                        </button>
                    `;
                            },
                            orderable: false,
                            searchable: false
                        }
                    ],
                    language: {
                        url: '//cdn.datatables.net/plug-ins/1.11.5/i18n/es-ES.json'
                    }
                });

                // Modal de productos usando Bootstrap
                var productoModal = new bootstrap.Modal(document.getElementById('productoModal'));

                // Nuevo producto
                $('#nuevoProductoBtn').click(function () {
                    $('#modalTitle').text('Nuevo Producto');
                    $('#productoForm')[0].reset();
                    $('#productoId').val('');
                    productoModal.show();
                });

                // Editar producto
                $('#productosTable').on('click', '.edit-btn', function () {
                    var id = $(this).data('id');

                    $.ajax({
                        url: '/ExamenMod2CriptoJara/productosservlet?action=get&id=' + id,
                        type: 'GET',
                        dataType: 'json',
                        success: function (producto) {
                            $('#modalTitle').text('Editar Producto');
                            $('#productoId').val(producto.codiProd);
                            $('#nombre').val(producto.nombProd);
                            $('#descripcion').val(producto.descProd);
                            $('#precio').val(producto.precProd);
                            $('#stock').val(producto.stockProd);
                            productoModal.show();
                        },
                        error: function (xhr) {
                            toastr.error('Error al cargar producto: ' + xhr.statusText);
                        }
                    });
                });

                // Guardar producto (crear o editar)
                $('#btnGuardar').click(function () {
                    var formData = {
                        id: $('#productoId').val(),
                        nombre: $('#nombre').val(),
                        descripcion: $('#descripcion').val(),
                        precio: $('#precio').val(),
                        stock: $('#stock').val()
                    };

                    var action = formData.id ? 'edit' : 'create';

                    $.ajax({
                        url: '/ExamenMod2CriptoJara/productosservlet?action=' + action,
                        type: 'POST',
                        data: formData,
                        dataType: 'json',
                        success: function (response) {
                            if (response.success) {
                                productoModal.hide();
                                table.ajax.reload(null, false);
                                toastr.success(response.message);
                            } else {
                                toastr.error(response.message);
                            }
                        },
                        error: function (xhr) {
                            toastr.error('Error: ' + (xhr.responseJSON?.message || xhr.statusText));
                        }
                    });
                });

                // Eliminar producto
                $('#productosTable').on('click', '.delete-btn', function () {
                    var id = $(this).data('id');

                    if (confirm('¿Está seguro de eliminar este producto?')) {
                        $.ajax({
                            url: '/ExamenMod2CriptoJara/productosservlet?action=delete',
                            type: 'POST',
                            data: {id: id},
                            dataType: 'json',
                            success: function (response) {
                                if (response.success) {
                                    table.ajax.reload(null, false);
                                    toastr.success(response.message);
                                } else {
                                    toastr.error(response.message);
                                }
                            },
                            error: function (xhr) {
                                toastr.error('Error al eliminar: ' + xhr.statusText);
                            }
                        });
                    }
                });
            });

            function cambiarClave() {
                const form = document.getElementById("formCambiarPass");
                const formData = new FormData(form);

                // Validar que las nuevas contraseñas coincidan
                if (formData.get("newPass") !== formData.get("confirmPass")) {
                    document.getElementById("passError").classList.remove("d-none");
                    return;
                }

                // Hashear contraseñas con SHA-1
                const currentPassHash = CryptoJS.SHA1(formData.get("currentPass")).toString();
                const newPassHash = CryptoJS.SHA1(formData.get("newPass")).toString();

                // Obtener el usuario del JWT
                const token = document.cookie.replace(/(?:(?:^|.*;\s*)token\s*=\s*([^;]*).*$)|^.*$/, "$1");
                const username = JSON.parse(atob(token.split('.')[1])).sub;

                // Enviar al servlet cambiarclave
                fetch("http://localhost:8080/ExamenMod2CriptoJara/cambiarclave", {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        user: username,
                        currentPass: currentPassHash,
                        newPass: newPassHash
                    })
                })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                alert("Contraseña cambiada exitosamente");
                                $('#cambiarPassModal').modal('hide'); // Cerrar modal
                            } else {
                                alert(data.message || "Error al cambiar contraseña");
                            }
                        })
                        .catch(error => {
                            console.error("Error:", error);
                            alert("Error en la conexión");
                        });
            }
        </script>

        <!-- Modal para productos (añade esto antes del cierre del body) -->
        <div class="modal fade" id="productoModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalTitle">Nuevo Producto</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="productoForm">
                            <input type="hidden" id="productoId">
                            <div class="mb-3">
                                <label class="form-label">Nombre</label>
                                <input type="text" class="form-control" id="nombre" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Descripción</label>
                                <textarea class="form-control" id="descripcion" rows="3"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Precio</label>
                                <input type="number" step="0.01" class="form-control" id="precio" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Stock</label>
                                <input type="number" class="form-control" id="stock" required>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="btnGuardar">Guardar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para cambio de contraseña -->
        <div class="modal fade" id="cambiarPassModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">Cambiar contraseña</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="formCambiarPass" onsubmit="return false;">
                            <div class="mb-3">
                                <label class="form-label">Contraseña actual</label>
                                <input type="password" name="currentPass" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Nueva contraseña</label>
                                <input type="password" name="newPass" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Confirmar nueva contraseña</label>
                                <input type="password" name="confirmPass" class="form-control" required>
                                <div id="passError" class="text-danger small mt-1 d-none">Las contraseñas no coinciden</div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" onclick="cambiarClave()">Guardar</button>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
